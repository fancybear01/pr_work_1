Эмулятор оболочки с виртуальной файловой системой (VFS)

Проект — учебный эмулятор командной оболочки с простым графическим интерфейсом на Tkinter. Поддерживается виртуальная файловая система (VFS), загрузка содержимого из ZIP-архива, выполнение стартового скрипта, а также базовые команды оболочки.

Основной файл приложения: `main.py`.

## Возможности

- GUI на Tkinter: окно вывода и поле ввода команд.
- Виртуальная ФС (VFS) в памяти:
	- Загрузка из ZIP-архива с автоматическим обрезанием общего префикса путей.
	- Текстовые файлы читаются как UTF-8, бинарные — в Base64 (флаг `is_binary`).
	- Изменения хранятся только в памяти (не сохраняются обратно в ZIP).
- Стартовый скрипт: последовательное выполнение команд из файла (`--startup-script`).
- История команд (стрелки вверх/вниз).
- Раскрытие переменных окружения и тильды: `~`, `$VAR`, `${VAR}`, а также `%VAR%` (Windows).
	- Если введено только `~` или только переменная (например, `$HOME`), выводится её значение, а не ошибка.
- Поддерживаемые команды:
	- `ls`
	- `cd`
	- `find`
	- `pwd`
	- `touch`
	- `chown`
	- `vfs-init`
	- `exit`

## Требования

- Python 3.8+ (проверено на Windows)
- Библиотека Tkinter (обычно входит в состав стандартной установки Python для Windows)

Дополнительных зависимостей нет — используется только стандартная библиотека Python.

## Установка и запуск

1) Склонируйте репозиторий или скопируйте проект в локальную папку.

2) Запуск без VFS и без скрипта:

```powershell
python .\main.py
```

3) Запуск с загрузкой VFS из ZIP и выполнением стартового скрипта:

```powershell
python .\main.py --vfs-path .\test_vfs.zip --startup-script .\test_vfs.sh
```

Пояснения:
- `--vfs-path` — путь к ZIP-архиву с содержимым виртуальной ФС (например, архив папки `test_vfs/`).
- `--startup-script` — скрипт с командами, по одной на строку. Строки, начинающиеся с `#`, считаются комментариями и игнорируются.

## Структура примера VFS

В проекте есть пример структуры VFS (папка `test_vfs/`):

```
test_vfs/
	file3.txt
	folder1/
		folder1.txt
		folder4/
	folder2/
		cat.png
```

Чтобы использовать её как `--vfs-path`, упакуйте папку `test_vfs/` в ZIP (например, `test_vfs.zip`).

## Команды оболочки

Ниже описаны поддерживаемые команды и их поведение в рамках VFS.

- ls
	- Выводит элементы текущего каталога (только непосредственных потомков).
	- Пустой каталог: выводит `(empty directory)`.

- cd PATH
	- Переход в каталог. Поддерживаются абсолютные пути (`/`) и относительные пути.
	- `cd /` всегда возвращает в корень VFS.
	- Примечание: специальные сегменты `.` и `..` для `cd` пока не нормализуются (в отличие от некоторых других команд).

- find [DIR] PATTERN | find PATTERN
	- Поиск по имени (шаблон `fnmatch`, например, `*.txt`).
	- Если указаны два аргумента: первый — стартовый каталог (например, `/` или `folder1/`), второй — шаблон.
	- Если указан один аргумент: он трактуется либо как каталог (если существует), либо как шаблон.
	- Выводит соответствующие ключи VFS (пути внутри виртуальной ФС). Если ничего не найдено — `(no matches)`.

- pwd
	- Печатает текущий путь внутри VFS. Корень отображается как `/`.

- touch FILE
	- Создает пустой файл или обновляет время модификации существующего.
	- Родительский каталог должен существовать. Нельзя создавать каталоги (только файлы).
	- Новый файл получает владельца = текущий пользователь ОС, время mtime = текущее UTC.

- chown [-R] OWNER PATH
	- Меняет владельца файла или каталога в VFS.
	- Для каталога без `-R` изменяется только сам каталог (если он существует как отдельный ключ каталога в VFS). С `-R` — рекурсивно для всех вложенных ключей.
	- Если путь не найден — будет соответствующее сообщение об ошибке.

- vfs-init
	- Очищает текущую VFS (делает её пустой) и ставит текущий каталог на корень.
	- Если был указан `--vfs-path` и файл существует, физический ZIP будет удалён.

- exit
	- Закрывает приложение.

## Переменные окружения и тильда

Парсер командной строки поддерживает:
- `~` и `~user` (через `os.path.expanduser`)
- `$VAR`, `${VAR}` (Unix-стиль)
- `%VAR%` (Windows-стиль)

Если введён единственный токен вида `~` или переменной (`$HOME` и т.п.), эмулятор выведет раскрытое значение вместо ошибки «Command not found».

## Примеры

Простой сценарий:

```text
> ls
(empty directory)
> vfs-init
VFS initialized to empty state
> ls
(empty directory)
> touch notes.txt
created: notes.txt
> ls
notes.txt
> pwd
/
```

Поиск по шаблону в загруженной VFS:

```text
> find *.txt
file3.txt
folder1/folder1.txt
```

Работа с правами владельца:

```text
> chown Ivan folder1
chown: updated 1 item(s)
> chown -R Ivan folder1
chown: updated N item(s)
```

## Известные ограничения

- Изменения VFS не сохраняются обратно в ZIP (данные существуют только в памяти во время работы приложения).
- Команда `cd` пока не нормализует `.` и `..`. Другие команды частично учитывают `.`/`..` внутри собственного резолвера путей.
- Нет команд `mkdir/rmdir`, `rm`, `cat/echo` и т.д. (можно добавить при необходимости).

## Полезные файлы в репозитории

- `main.py` — код эмулятора.
- `test_vfs/` — пример содержимого для упаковки в ZIP и загрузки как VFS.
- `test_vfs.sh` — пример стартового скрипта (последовательность команд). Строки, начинающиеся с `#`, игнорируются.
- `test_simple.sh` — простой пример команд.